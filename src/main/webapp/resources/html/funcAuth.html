<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>★★★ 功能权限管理页面 ★★★</title>
<script type="text/javascript" src="../js/inspiniaCommon.js"></script>
<style>
    /* Additional style to fix warning dialog position */
    #alertmod_table_list_2{
        top: 900px !important;
    }
</style>
</head>

<body>

    <div id="wrapper">
        <div class="gray-bg">
	        <div class="wrapper wrapper-content  animated fadeInRight">
	        	<div class="ibox-content m-b-sm border-bottom">
	                <div class="row">
	                    <div class="col-sm-6">
	                        <div class="form-group">
	                            <label class="control-label">角色名称</label>
	                            <input type="text" id="auth_roleName" value="" placeholder="角色名称" data-toggle="modal" data-target="#roleFormModal" class="form-control">
	                        </div>
	                    </div>
	                </div>
	            </div>
	            
	            <div class="modal inmodal" id="roleFormModal" tabindex="-1" role="dialog" aria-hidden="true">
                    <div class="modal-dialog modal-lg">
                    	<div class="modal-content animated bounceInRight">
                            <div class="modal-header" style="height:10px;line-height:10px;padding:0px 15px 26px 15px;">
                                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                                <h3 id="modalTitle">选择角色</h3>
                                <small class="font-bold"></small>
                            </div>
                            <div class="modal-body" style="margin:0; padding:0;">
                            	<iframe src="roleQueryPage.html" id="roleFrame" >
                            		
                            	</iframe>
                            </div>
                            
                            <div class="modal-footer" style="text-align:center;padding:2px;">
                                <button type="button" class="btn btn-primary" data-dismiss="modal">选择</button>
                            </div>
                        </div>
                    </div>
                </div>
	            
	            <div class="row">
	                <div class="col-lg-12">
	                    <div class="ibox ">
	                        <div class="ibox-title">
	                            <h5>模块 — — 角色-功能权限配置</h5>
	                        </div>
	                        
	                        <div class="ibox-content">
	
								<p>
			                        <button class="btn btn-info " type="button" data-toggle="modal" data-target="#roleFormModal" onclick="initEditData()"><i class="fa fa-edit"></i>&nbsp;配置</button>
			                        <button class="btn btn-warning " type="button"><i class="fa fa-upload"></i>&nbsp;导出</button>
			                    </p>
	                            <div class="jqGrid_wrapper">
	                                <table id="table_list_2"></table>
	                                <div id="pager_list_2"></div>
	                            </div>
	                        </div>
	                    </div>
	                </div>
	            </div>
	        </div>

        </div>
    </div>




    <script>
    	
    	
    	var selId;//被选中的行号ID 
    	var gridHeight;
        $(document).ready(function () {
        	validForm();
        	
        	var l = $('.ladda-button').ladda();
	        l.click(function(){
	            l.ladda('start');
	            setTimeout(function(){
	                l.ladda('stop');
	            },800)
	        });
	        
        	var windowHeight = document.body.clientHeight;
        	gridHeight = windowHeight-260;
        	initTreeGridData();
        	var frameheight = windowHeight-150;
        	
            // 将jqgrid 宽度设置为 可以伸缩
            $(window).bind('resize', function () {
                var width = $('.jqGrid_wrapper').width();
                $('#table_list_2').setGridWidth(width);
                //$('#roleFrame').css({"width":"100%","height":gridHeight-200});
            });
            
            //将放大镜 frame 宽高设置
            $('#roleFrame').css({"width":"100%","height":frameheight});
        });

        
        function initTreeGridData(){
        	$("#table_list_2").jqGrid({
        	   	url:'/role/getAuthRoleList',
        	   	//postData:{'roleId':'1111'},
        		mtype : "POST",
        		contentType : "application/json",
        		datatype: 'json',
        		autowidth: true,
        		shrinkToFit: true,
        		rownumbers: true, //是否显示序号列 true显示，false不显示
        		colNames:['主键ID', '功能权限名称', '创建时间'],
                colModel:[
                    {name:'id',index:'id', editable: true, width:60, sorttype:"int",search:true},
                    {name:'name',index:'name', editable: true, width:90, sorttype:"string"},
                    {name:'crtDate',index:'crtDate', editable: true, sorttype:"date", width:100},
                ],
        	   	rowNum:10,
        	   	rowList:[10,20,100],
        	   	pager: '#pager_list_2',
        	   	//sortname: 'id',
        	    viewrecords: true,
        	    sortorder: "desc",
        	    hidegrid: true,
        	    caption:"功能权限列表",
        		onSelectRow : function(rowid,
        				status) {
        			selId = rowid;
        			
        		}
        	});
        	
        	$("#table_list_2").jqGrid('navGrid','#pager_list_2',{edit:false,add:false,del:false,search:false, reloadAfterSubmit:true});
        	$('#table_list_2').setGridHeight('320');
        	$('#table_list_2').jqGrid('setLabel','rn', '序号', {'text-align':'left','color':'blue'},'');
        }
        
        /**
         * 初始化 新增数据值
         */
        function initNewData(){
        	$("#modalTitle")[0].innerText = '新增功能权限';
        }
        
        /**
         * 初始化 修改数据值
         */
        function initEditData(){
        	$("#modalTitle")[0].innerText = '修改功能权限';
        	//$.Pop("请选择至少一条数据！", 'confirm', function(){});
        	var rowid = $("#table_list_2").jqGrid("getGridParam","selrow");
        	if(!isEmpty(rowid)){
        		//debugger;
        		var rowData = $("#table_list_2").jqGrid('getRowData',rowid);//获取该行数据
        		$("#roleId").val(rowData.id);
        		$("#roleName").val(rowData.name);
        	}else{
        		$.Pop("请选择至少一条数据！", 'alert', function(){});
        		return;
        	}
        }
        
        /**
         * 删除按钮
         */
        function on_delrole(){
        	var rowid = $("#table_list_2").jqGrid("getGridParam","selrow");
        	if(!isEmpty(rowid)){
        		$.Pop('确认删除吗？','confirm',function(){
        			$.ajax({
        				url: '/role/deleteRole',
        				type: 'POST',
        				data: {
        					id : rowid,
        				},
        				dataType: 'json',
        				success: function(resp){
        					var status = resp.status;
        					if(status == '00'){
        						toastr.success('删除成功!', '提示！');
        						reloadGridData('table_list_2');
        					}else{
        						var message = resp.message;
        						$.Pop(message, 'alert', function(){});
        					}
        				},
        				error: function(a, b, c){
        					alert(a+"--"+b+"--"+c);
        				}
        			});
        		});
        	}else{
        		$.Pop("请选择至少一条数据！", 'alert', function(){});
        		return;
        	}
        }
        
        /**
         * 验证form表单
         */
        function validForm(){
        	$("#roleForm").validate({
                rules: {
                    password: {
                        required: true,
                        minlength: 3
                    },
                    url: {
                        required: true,
                        //url: true
                    },
                    number1: {
                        required: true,
                        number: true
                    },
                    number2: {
                        required: true,
                        number: true
                    },
                    number3: {
                        required: true,
                        number: true
                    },
                    min: {
                        required: true,
                        minlength: 3
                    },
                    max: {
                        required: true,
                        maxlength: 6
                    }
                    /* select: {
                    	required: true,
                    } */
                }
            });
        }
        
        /**
         * 保存功能权限
         */
        function on_saverole(){
        	var v_id = $("#roleId").val();
        	if(isEmpty(v_id)){
        		v_id = '0';
        	}
        	var v_roleName = $("#roleName").val();
        	$.ajax({
				url: '/role/saveRole',
				type: 'POST',
				data: {
					Id : v_id,
					name : v_roleName,
				},
				dataType: 'json',
				success: function(resp){
					var status = resp.status;
					if(status == '00'){
						toastr.success('保存成功22!', '提示！');
						$.Pop("保存成功111", 'alert', function(){});
						reloadGridData('table_list_2');
					}else{
						var message = resp.message;
						$.Pop(message, 'alert', function(){});
					}
				},
				error: function(a, b, c){
					alert(a+"--"+b+"--"+c);
				}
			});
        }
        
        //选择下拉框
        var config = {
            '.chosen-select'           : {},
            '.chosen-select-deselect'  : {allow_single_deselect:true},
            '.chosen-select-no-single' : {disable_search_threshold:10},
            '.chosen-select-no-results': {no_results_text:'Oops, nothing found!'},
            '.chosen-select-width'     : {width:"95%"}
        }
        for (var selector in config) {
            $(selector).chosen(config[selector]);
        }
        
        //条件搜索功能
        function do_searchTreerole(){
        	var sch_roleName = $('#sch_roleName').val();
        	var sch_roleLevel = $('#sch_roleLevel').val();
        	var sch_leafFlag = $('#sch_leafFlag option:selected').val();
        	var postData = {
       			name : sch_roleName,
           		treeLevel : sch_roleLevel,
           		leafFlag : sch_leafFlag
        	};
        	var params = {
        		postData : postData
        	}
        	reloadGridData('table_list_2', params);
        }
        
        function do_reset(){
        	//$("#sch_roleForm").resetForm();
        	$("#sch_roleForm")[0].reset();
        }
        
        //打开 角放大镜
        function openRolePanel(){
        	
        }
        
    </script>


</body>

</html>
